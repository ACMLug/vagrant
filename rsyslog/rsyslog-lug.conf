#  Default rules for rsyslog.

# Increase log messsage size
$MaxMessageSize 24K

#### MODULES ####

# Load (i)nput and (o)utput (m)odules
module(load="imuxsock")
module(load="imudp")
module(load="imtcp" MaxSessions="500")
module(load="omrelp")
module(load="impstats" interval="300" severity="7" log.syslog="off" log.file="/impstats/rsyslog-stats.log")

# Module parameters
input(type="imtcp" port="514" ruleset="remote")
input(type="imudp" port="514" ruleset="remote")
# RateLimit.Interval="5" RateLimit.Burst="1000"

#### TEMPLATES ####

template(name="ByHost" type="string" string="/usr/local/logs/%$YEAR%/%$MONTH%/%$DAY%/%HOSTNAME%.log")

#### GLOBAL DIRECTIVES ####

# Use default timestamp format
$ActionFileDefaultTemplate RSYSLOG_TraditionalFileFormat

# Include all config files in /etc/rsyslog.d/
$IncludeConfig /etc/rsyslog.d/*.conf

# Spool files
$WorkDirectory /var/spool/rsyslog

# Filter duplicate messages
$RepeatedMsgReduction on

#### RULES ####
# ACL's: Accept from these networks/hosts only
$AllowedSender UDP, 10.1.1.0/24
$AllowedSender TCP, 10.1.1.0/24

ruleset(name="remote"){
        action(type="omfile" DynaFile="ByHost")
}
